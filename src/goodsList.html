<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta content="telephone=no,email=no" name="format-detection">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <script src="http://g.tbcdn.cn/mtb/lib-flexible/0.3.4/??flexible_css.js,flexible.js"></script>
    <title>商品列表</title>
    <link rel="stylesheet" href="//res.wx.qq.com/open/libs/weui/1.1.0/weui.min.css">
    <link href="//cdn.bootcss.com/Swiper/3.4.0/css/swiper.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/base.css">
    <link rel="stylesheet" href="./css/goodsList.css">
</head>

<body>
    <div class="container" id='app'>
        <div class="content no-sidebar">
            <div class="content-body">
                <ul class="js-goods-list sc-goods-list pic clearfix size-1">
                    <li class="js-goods-card goods-card small-pic card" v-for='item in goods_list'>
                        <a href="./goodsDetail.html" class="js-goods link clearfix" target="_blank" :title="item.goods_name">
                            <div class="photo-block" data-width="0" data-height="0" style="background-color: rgb(255, 255, 255);">
                                <img class="goods-photo js-goods-lazy" :data-original="item.image_url">
                            </div>
                            <div class="info clearfix info-no-title info-price btn1">
                                <p class=" goods-title" v-text="item.goods_name"></p>
                                <p class="goods-sub-title c-black hide"></p>
                                <p class="goods-price">
                                    <em>￥{{item.price}}</em>
                                </p>
                            </div>
                            <div class="goods-buy btn1 info-no-title"></div>
                            <div class="js-goods-buy buy-response"></div>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <script src="//cdn.bootcss.com/zepto/1.2.0/zepto.min.js"></script>
    <script src="../lib/lazyload/lazyload.min.js"></script>
    <!-- <script src="//res.wx.qq.com/open/js/jweixin-1.0.0.js"></script> -->
    <script src="//cdn.bootcss.com/vue/2.1.3/vue.min.js"></script>
    <script src="//cdn.bootcss.com/Swiper/3.4.0/js/swiper.jquery.min.js"></script>
    <script src="./js/common.js"></script>
    <script>
    var vm = new Vue({
        el: '#app',
        data: {
            goods_list: [],
            page_size: 10,
            page_no: 0,
            is_end: false,
            io: true,
        },
        mounted: function() {
        	var _self = this;
            _self.getGoodsList();
            $(window).scroll(function(){
            	var bot = 100; //bot是底部距离的高度
		        if ((bot + $(window).scrollTop()) >= ($(document).height() - $(window).height())) {
		           	//当底部基本距离+滚动的高度〉=文档的高度-窗体的高度时；
		            //我们需要去异步加载数据了
		            if (!_self.is_end) {
		            	if (_self.io) {
		            		_self.io = false;
				            _self.page_no++;
				            _self.getGoodsList();
		            	}
		            }
		        }
            })
        },
        methods: {
            getGoodsList() {
                var _self = this;
                http({
                    url: './4.txt',
                    success: function(data) {
                    	if (data.data.goods_list.length!=0) {
	                    	for (var i = 0; i < data.data.goods_list.length; i++) {
	                    		_self.goods_list.push(data.data.goods_list[i]);
	                    	}                    		
                    	}else{
                    		_self.is_end = true;
                    	}
                    },
                    complete: function(data){
                    	_self.io = true;
                    	_self.$nextTick(function(){
                    		$("img.js-goods-lazy").lazyload({
                    			threshold: 200,
							  	effect : "fadeIn"
							});
                    	})
                    }
                })
            }
        }
    })
    </script>
</body>

</html>
